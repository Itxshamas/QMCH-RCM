@using Microsoft.AspNetCore.Components.Routing

<nav class="erp-sidebar" role="navigation" aria-label="Main navigation">
    <div class="sidebar-brand">
        <div class="brand-text" role="banner">
            <h4>QMCH PRO</h4>
        </div>
    </div>

    <div class="sidebar-nav">
        <div class="logo-container">
            <img src="images/logo.png" alt="Quality Homecare Medical Company Logo" class="company-logo" loading="lazy" />
        </div>

        <div class="sidebar-section-title" id="overview-section">Overview</div>

        <NavLink class="sidebar-item" href="/hmc/dashboard" Match="NavLinkMatch.All" title="Go to Dashboard">
            <i class="fas fa-th-large item-icon" aria-hidden="true"></i>
            <span class="item-label">Dashboard</span>
        </NavLink>

        <div class="sidebar-section-title" id="clinical-section">Clinical & Operations</div>

        <NavLink class="sidebar-item" href="/hmc/patients" title="View Patients">
            <i class="fas fa-user-injured item-icon" aria-hidden="true"></i>
            <span class="item-label">Patients</span>
        </NavLink>

        <NavLink class="sidebar-item" href="/hmc/staff" title="View Staff">
            <i class="fas fa-user-nurse item-icon" aria-hidden="true"></i>
            <span class="item-label">Staff</span>
        </NavLink>

        <NavLink class="sidebar-item" href="/hmc/visits" title="View Scheduling & Visits">
            <i class="fas fa-calendar-alt item-icon" aria-hidden="true"></i>
            <span class="item-label">Scheduling & Visits</span>
        </NavLink>

        <NavLink class="sidebar-item" href="/hmc/documentation" title="Access Visit Documentation">
            <i class="fas fa-file-medical item-icon" aria-hidden="true"></i>
            <span class="item-label">Visit Documentation</span>
        </NavLink>

        <div class="sidebar-section-title" id="finance-section">Finance</div>

        <NavLink class="sidebar-item" href="/hmc/billing" title="Access Insurance & Billing">
            <i class="fas fa-file-invoice-dollar item-icon" aria-hidden="true"></i>
            <span class="item-label">Insurance & Billing</span>
        </NavLink>

        <NavLink class="sidebar-item" href="/hmc/claims" title="Manage Claims">
            <i class="fas fa-hand-holding-usd item-icon" aria-hidden="true"></i>
            <span class="item-label">Claims Management</span>
        </NavLink>

        <div @onclick='() => ToggleMenu("timesheets")' class="sidebar-item" role="button" tabindex="0"
             @onkeydown="@((KeyboardEventArgs e) => HandleMenuKeydown(e, "timesheets"))"
             title="Toggle Timesheets menu" aria-expanded="@IsExpanded("timesheets")">
            <i class="fas fa-clock item-icon" aria-hidden="true"></i>
            <span class="item-label">Timesheets</span>
            <i class="fa fa-chevron-right expand-icon @(IsExpanded("timesheets") ? "expanded" : "")" aria-hidden="true"></i>
        </div>
        @if (IsExpanded("timesheets"))
        {
            <div class="sidebar-children" role="region">
                <NavLink class="sidebar-item" href="/timesheet/payroll/list" title="Manage Payroll Timesheets">
                    <span class="item-label">Payroll Timesheet</span>
                </NavLink>
                <NavLink class="sidebar-item" href="/timesheet/billing/list" title="Manage Billing Timesheets">
                    <span class="item-label">Billing Timesheet</span>
                </NavLink>
                <NavLink class="sidebar-item" href="/billing/list/servicesummary/create" title="View Service Summary">
                    <span class="item-label">Service Summary</span>
                </NavLink>
            </div>
        }

        <div class="sidebar-section-title" id="system-section">System</div>

        <div @onclick='() => ToggleMenu("admin")' class="sidebar-item" role="button" tabindex="0"
             @onkeydown="@((KeyboardEventArgs e) => HandleMenuKeydown(e, "admin"))"
             title="Toggle Administration menu" aria-expanded="@IsExpanded("admin")">
            <i class="fas fa-user-shield item-icon" aria-hidden="true"></i>
            <span class="item-label">Administration</span>
            <i class="fa fa-chevron-right expand-icon @(IsExpanded("admin") ? "expanded" : "")" aria-hidden="true"></i>
        </div>
        @if (IsExpanded("admin"))
        {
            <div class="sidebar-children" role="region">
                <NavLink class="sidebar-item" href="/admin/users/list" title="Manage System Users">
                    <span class="item-label">System Users</span>
                </NavLink>
                <NavLink class="sidebar-item" href="/admin/audit-logs" title="View Audit Logs">
                    <span class="item-label">Audit Logs</span>
                </NavLink>
                <NavLink class="sidebar-item" href="/admin/settings" title="Configure Settings">
                    <span class="item-label">Settings</span>
                </NavLink>
            </div>
        }
    </div>
</nav>

@code {
private HashSet<string> _expandedMenus = new() { "admin", "timesheets" };

    private void ToggleMenu(string menuId)
    {
        if (_expandedMenus.Contains(menuId))
            _expandedMenus.Remove(menuId);
        else
            _expandedMenus.Add(menuId);
    }

    private void HandleMenuKeydown(KeyboardEventArgs e, string menuId)
    {
        if (e.Key == "Enter" || e.Key == " ")
        {
            ToggleMenu(menuId);
        }
    }

    private bool IsExpanded(string menuId) => _expandedMenus.Contains(menuId);
}
