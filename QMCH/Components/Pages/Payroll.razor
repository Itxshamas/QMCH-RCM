@page "/timesheet/payroll/list"
@rendermode InteractiveServer
@using QMCH.Models

<PageTitle>Payroll Timesheet - Quality Homecare</PageTitle>

<div class="payroll-list-page">

    @if (hasError)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error:</strong> @errorMessage
            <button type="button" class="btn-close"
                    @onclick="@(() => hasError = false)"
                    aria-label="Close"></button>
        </div>
    }

    <div class="page-header">
        <div class="header-left">
            <h1>PAYROLL TIMESHEET</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active">Payroll Timesheet</li>
                </ol>
            </nav>
        </div>

        <div class="header-right">
            <button class="btn btn-primary"
                    @onclick="CreateNew">
                <i class="fas fa-plus"></i> Create Timesheet
            </button>
        </div>
    </div>

    <div class="content-container">

        <!-- FILTER SECTION -->
        <div class="filter-card">
            <div class="filter-row">

                <div class="filter-group">
                    <label class="filter-label">Category</label>
                    <select class="form-select"
                            @bind="selectedCategory"
                            @bind:after="ApplyFilters">
                        <option value="">--Select--</option>
                        @foreach (var category in categories)
                        {
                            <option value="@category">@category</option>
                        }
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Nurse</label>
                    <select class="form-select"
                            @bind="selectedNurseId"
                            @bind:after="ApplyFilters">
                        <option value="0">(All Nurses)</option>
                        @foreach (var nurse in nurses)
                        {
                            <option value="@nurse.Id">
                                @nurse.FirstName @nurse.LastName
                            </option>
                        }
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">From Date</label>
                    <input type="date"
                           class="form-control"
                           @bind="fromDate"
                           @bind:after="ApplyFilters" />
                </div>

                <div class="filter-group">
                    <label class="filter-label">To Date</label>
                    <input type="date"
                           class="form-control"
                           @bind="toDate"
                           @bind:after="ApplyFilters" />
                </div>

            </div>

            <div class="filter-actions">
                <button class="btn btn-outline"
                        @onclick="ClearFilters">
                    Clear Filters
                </button>
            </div>
        </div>

        <!-- TABLE -->
        <div class="table-container">

            @if (isLoading)
            {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary"></div>
                    <p class="mt-2">Loading timesheets...</p>
                </div>
            }
            else if (filteredPayrolls == null || !filteredPayrolls.Any())
            {
                <div class="text-center py-5">
                    <p>No data available in table</p>
                </div>
            }
            else
            {
                <table class="table custom-table">
                    <thead>
                        <tr>
                            <th>Timesheet Code</th>
                            <th>Nurse ID</th>
                            <th>Name</th>
                            <th>Payperiod From</th>
                            <th>Payperiod To</th>
                            <th>Received</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in filteredPayrolls)
                        {
                            <tr>
                                <td><strong>TS-@item.Id.ToString("D5")</strong></td>
                                <td>@item.EmployeeId</td>
                                <td>@item.EmployeeName</td>
                                <td>@item.PeriodStart.ToString("yyyy-MM-dd")</td>
                                <td>@item.PeriodEnd.ToString("yyyy-MM-dd")</td>
                                <td>
                                    <span class="badge @GetStatusBadge(item.Status)">
                                        @item.Status
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-primary"
                                                @onclick='() => EditPayroll(item.Id)'>
                                            Edit
                                        </button>

                                        <button class="btn btn-sm btn-danger"
                                                @onclick='() => DeletePayroll(item.Id)'>
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

                <div class="pagination-info">
                    Showing @filteredPayrolls.Count entries
                </div>
            }

        </div>
    </div>
</div>
