@page "/hmc/staff/detail/{staffId:int}"
@using QMCH.Models
@using QMCH.Services
@using StaffModel = QMCH.Models.Staff
@rendermode InteractiveServer

<PageTitle>Staff Member Details - Quality Homecare System</PageTitle>

<div class="page-header">
    <div class="page-header-content">
        <h1>@(staff?.FullName ?? "Loading...")</h1>
        <p>@(staff?.Role ?? "Staff Member") | ID: @(staff?.StaffId ?? "-")</p>
    </div>
    <div class="page-header-actions">
        <button class="action-btn edit-btn" @onclick="() => NavigateToEdit()">
            <i class="fa fa-edit"></i> Edit
        </button>
        <button class="action-btn delete-btn" @onclick="() => ConfirmDelete()">
            <i class="fa fa-trash"></i> Delete
        </button>
    </div>
</div>

@if (isLoading)
{
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading staff details...</p>
    </div>
}
else if (staff is not null)
{
    <div class="detail-container">
        <!-- Personal Information Section -->
        <div class="detail-section">
            <div class="section-header">
                <h2><i class="fa fa-user"></i> Personal Information</h2>
            </div>
            <div class="section-content">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Full Name</label>
                        <span>@staff.FirstName @(staff.MiddleName != null ? staff.MiddleName + " " : "")@staff.LastName</span>
                    </div>
                    <div class="detail-item">
                        <label>Date of Birth</label>
                        <span>@staff.DateOfBirth.ToString("MMM dd, yyyy")</span>
                    </div>
                    <div class="detail-item">
                        <label>Gender</label>
                        <span>@(staff.Gender ?? "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>Staff ID</label>
                        <span>@staff.StaffId</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Professional Information Section -->
        <div class="detail-section">
            <div class="section-header">
                <h2><i class="fa fa-briefcase"></i> Professional Information</h2>
            </div>
            <div class="section-content">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Role</label>
                        <span>@(staff.Role ?? "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>Department</label>
                        <span>@(staff.Department ?? "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>Hire Date</label>
                        <span>@staff.HireDate.ToString("MMM dd, yyyy")</span>
                    </div>
                    <div class="detail-item">
                        <label>License Number</label>
                        <span>@(staff.LicenseNumber ?? "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>License Expiry</label>
                        <span>
                            @if (staff.LicenseExpiryDate.HasValue)
                            {
                                <span class="@(staff.LicenseExpiryDate.Value < DateTime.Now ? "status-expired" : "")">
                                    @staff.LicenseExpiryDate.Value.ToString("MMM dd, yyyy")
                                </span>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        </span>
                    </div>
                    <div class="detail-item">
                        <label>Hourly Rate</label>
                        <span>@(staff.HourlyRate.HasValue ? "$" + staff.HourlyRate.Value.ToString("F2") : "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>Status</label>
                        <span class="badge" style="background-color: @GetStatusColor(staff.Status)">@staff.Status</span>
                    </div>
                    <div class="detail-item">
                        <label>Available</label>
                        <span class="badge" style="background-color: @(staff.IsAvailable ? "#28a745" : "#6c757d")">
                            @(staff.IsAvailable ? "Yes" : "No")
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div class="detail-section">
            <div class="section-header">
                <h2><i class="fa fa-phone"></i> Contact Information</h2>
            </div>
            <div class="section-content">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Email</label>
                        <span>
                            @if (!string.IsNullOrEmpty(staff.Email))
                            {
                                <a href="mailto:@staff.Email">@staff.Email</a>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        </span>
                    </div>
                    <div class="detail-item">
                        <label>Phone</label>
                        <span>
                            @if (!string.IsNullOrEmpty(staff.Phone))
                            {
                                <a href="tel:@staff.Phone">@staff.Phone</a>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        </span>
                    </div>
                    <div class="detail-item full-width">
                        <label>Address</label>
                        <span>@(staff.Address ?? "-")</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Contact Section -->
        <div class="detail-section">
            <div class="section-header">
                <h2><i class="fa fa-exclamation-circle"></i> Emergency Contact</h2>
            </div>
            <div class="section-content">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Name</label>
                        <span>@(staff.EmergencyContactName ?? "-")</span>
                    </div>
                    <div class="detail-item">
                        <label>Phone</label>
                        <span>
                            @if (!string.IsNullOrEmpty(staff.EmergencyContactPhone))
                            {
                                <a href="tel:@staff.EmergencyContactPhone">@staff.EmergencyContactPhone</a>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Tabs Section -->
        <div class="action-tabs">
            <div class="tabs-header">
                <button class="tab-btn @(activeTab == "skills" ? "active" : "")" @onclick="@(() => activeTab = "skills")">
                    <i class="fa fa-star"></i> Skills
                </button>
                <button class="tab-btn @(activeTab == "licenses" ? "active" : "")" @onclick="@(() => activeTab = "licenses")">
                    <i class="fa fa-certificate"></i> Licenses
                </button>
                <button class="tab-btn @(activeTab == "schedule" ? "active" : "")" @onclick="@(() => activeTab = "schedule")">
                    <i class="fa fa-calendar"></i> Schedule
                </button>
                <button class="tab-btn @(activeTab == "compliance" ? "active" : "")" @onclick="@(() => activeTab = "compliance")">
                    <i class="fa fa-check-circle"></i> Compliance
                </button>
            </div>

            <div class="tabs-content">
                @if (activeTab == "skills")
                {
                    <div class="tab-pane">
                        <p class="placeholder-text">No skills recorded. <a href="/hmc/staff/skills/@StaffId">Add skills</a></p>
                    </div>
                }
                @if (activeTab == "licenses")
                {
                    <div class="tab-pane">
                        <p class="placeholder-text">No licenses recorded. <a href="/hmc/staff/licenses/@StaffId">Add licenses</a></p>
                    </div>
                }
                @if (activeTab == "schedule")
                {
                    <div class="tab-pane">
                        <p class="placeholder-text">No schedule entries. <a href="/hmc/staff/schedule/@StaffId">View schedule</a></p>
                    </div>
                }
                @if (activeTab == "compliance")
                {
                    <div class="tab-pane">
                        <p class="placeholder-text">No compliance records. <a href="/hmc/compliance/staff/@StaffId">View compliance</a></p>
                    </div>
                }
            </div>
        </div>

        <!-- Metadata Section -->
        <div class="detail-section metadata-section">
            <div class="metadata-grid">
                <div class="metadata-item">
                    <span class="label">Created</span>
                    <span class="value">@staff.CreatedAt.ToString("MMM dd, yyyy HH:mm")</span>
                </div>
                <div class="metadata-item">
                    <span class="label">Last Updated</span>
                    <span class="value">@staff.UpdatedAt.ToString("MMM dd, yyyy HH:mm")</span>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="error-state">
        <p>Staff member not found.</p>
    </div>
}

@if (showDeleteConfirm)
{
    <div class="modal-overlay">
        <div class="modal-content">
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete this staff member? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn cancel-btn" @onclick="() => showDeleteConfirm = false">Cancel</button>
                <button class="btn confirm-btn" @onclick="ConfirmDeleteAction">Delete</button>
            </div>
        </div>
    </div>
}
