@page "/hmc/staff"
@using QMCH.Models
@using QMCH.Interfaces.Services
@inject IStaffService StaffService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Staff Management - Quality Homecare</PageTitle>

<div class="staff-list-page">
    <div class="page-header">
        <div class="header-left">
            <h1>STAFF MANAGEMENT</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active">Staff</li>
                </ol>
            </nav>
        </div>
        <div class="header-right">
            <button class="btn btn-primary" @onclick="CreateNew">
                <i class="fas fa-plus"></i> NEW STAFF MEMBER
            </button>
        </div>
    </div>

    <div class="content-container">
        <div class="filter-card">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search by name, role or ID..." @bind="searchTerm" @bind:event="oninput" @bind:after="ApplyFilters" />
            </div>
            <div class="filter-actions">
                <select class="form-select" @bind="roleFilter" @bind:after="ApplyFilters">
                    <option value="">All Roles</option>
                    <option value="Nurse">Nurse</option>
                    <option value="Aide">Aide</option>
                    <option value="Doctor">Doctor</option>
                </select>
            </div>
        </div>

        <div class="table-container shadow-sm">
            <table class="table custom-table">
                <thead>
                    <tr>
                        <th>Staff ID</th>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (filteredStaff == null)
                    {
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <div class="spinner-border text-primary" role="status"></div>
                                <p class="mt-2">Loading staff...</p>
                            </td>
                        </tr>
                    }
                    else if (!filteredStaff.Any())
                    {
                        <tr>
                            <td colspan="6" class="text-center py-5">
                                <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                                <p>No staff members found.</p>
                            </td>
                        </tr>
                    }
                    else
                    {
                        @foreach (var staff in filteredStaff)
                        {
                            <tr>
                                <td class="fw-bold text-primary">@staff.StaffId</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm me-2 @(staff.Role.ToLower())">@staff.FirstName[0]@staff.LastName[0]</div>
                                        <div>
                                            <div class="fw-bold">@staff.FullName</div>
                                            <div class="text-muted small">@staff.Email</div>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="role-label @(staff.Role.ToLower())">@staff.Role</span></td>
                                <td>@staff.Phone</td>
                                <td>
                                    <span class="status-badge @(staff.Status.ToLower())">@staff.Status</span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@code {
    private IEnumerable<Staff>? staffList;
    private IEnumerable<Staff>? filteredStaff;
    private string searchTerm = "";
    private string roleFilter = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadStaff();
    }

    private async Task LoadStaff()
    {
        staffList = await StaffService.GetAllStaffAsync();
        ApplyFilters();
    }

    private void ApplyFilters()
    {
        if (staffList == null) return;

        filteredStaff = staffList.Where(s =>
            (string.IsNullOrEmpty(searchTerm) || 
             s.FullName.Contains(searchTerm, StringComparison.OrdinalIgnoreCase) || 
             s.StaffId.Contains(searchTerm, StringComparison.OrdinalIgnoreCase)) &&
            (string.IsNullOrEmpty(roleFilter) || s.Role == roleFilter)
        ).ToList();
    }

    private void CreateNew() => Navigation.NavigateTo("/hmc/staff/create");
}

<style>
    .staff-list-page {
        padding: 2rem;
        background-color: #f8f9fa;
        min-height: calc(100vh - 60px);
    }

    .page-header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1a237e;
    }

    .content-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .filter-card {
        background: white;
        padding: 1rem;
        border-radius: 0.5rem;
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }

    .search-box {
        position: relative;
        flex: 1;
    }

    .search-box i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #adb5bd;
    }

    .search-box input {
        width: 100%;
        padding: 0.625rem 1rem 0.625rem 2.5rem;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
    }

    .table-container {
        background: white;
        border-radius: 0.5rem;
        overflow: hidden;
    }

    .custom-table thead {
        background-color: #f1f3f9;
    }

    .custom-table thead th {
        font-weight: 600;
        padding: 1rem;
        font-size: 0.75rem;
        text-transform: uppercase;
    }

    .avatar-sm {
        width: 32px;
        height: 32px;
        background: #6c757d;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.75rem;
    }

    .avatar-sm.nurse { background-color: #3f51b5; }
    .avatar-sm.aide { background-color: #009688; }
    .avatar-sm.doctor { background-color: #673ab7; }

    .role-label {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.125rem 0.5rem;
        border-radius: 0.25rem;
        background: #f1f3f9;
        color: #495057;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-badge.active { background: #e8f5e9; color: #2e7d32; }
    .status-badge.inactive { background: #ffebee; color: #c62828; }

    .btn-primary {
        background-color: #004a99;
        border-color: #004a99;
    }
</style>
