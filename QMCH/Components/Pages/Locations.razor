@page "/client/location/all"
@inject IClientService ClientService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Locations - QHMCPro</PageTitle>

<div class="page-header">
    <div class="page-header-left">
        <h1>Locations</h1>
        <p>Manage service locations</p>
    </div>
    <div class="page-header-actions">
        <button class="btn btn-primary" @onclick="() => showModal = true"><i class="fa fa-plus"></i> Add
            Location</button>
    </div>
</div>

<DataGrid TItem="Location" Items="items" Title="Locations" IsLoading="isLoading">
    <HeaderTemplate>
        <th>Name</th>
        <th>Address</th>
        <th>City</th>
        <th>State</th>
        <th>Status</th>
        <th style="width: 100px;">Actions</th>
    </HeaderTemplate>
    <RowTemplate Context="item">
        <td><strong>@item.Name</strong></td>
        <td>@item.Address</td>
        <td>@item.City</td>
        <td>@item.State</td>
        <td><span class="badge @(item.IsActive ? "badge-success" : "badge-secondary")">@(item.IsActive ? "Active" :
                "Inactive")</span></td>
        <td><button class="btn btn-danger btn-sm" @onclick="() => Delete(item.Id)"><i class="fa fa-trash"></i></button>
        </td>
    </RowTemplate>
</DataGrid>

<ModalDialog @bind-IsVisible="showModal" Title="Add Location" Size="lg">
    <EditForm Model="newItem" OnValidSubmit="Save">
        <DataAnnotationsValidator />
        <div class="form-row">
            <div class="form-group"><label class="form-label">Name *</label>
                <InputText @bind-Value="newItem.Name" class="form-control" />
            </div>
            <div class="form-group"><label class="form-label">Phone</label>
                <InputText @bind-Value="newItem.Phone" class="form-control" />
            </div>
        </div>
        <div class="form-group"><label class="form-label">Address</label>
            <InputText @bind-Value="newItem.Address" class="form-control" />
        </div>
        <div class="form-row">
            <div class="form-group"><label class="form-label">City</label>
                <InputText @bind-Value="newItem.City" class="form-control" />
            </div>
            <div class="form-group"><label class="form-label">State</label>
                <InputText @bind-Value="newItem.State" class="form-control" />
            </div>
            <div class="form-group"><label class="form-label">Zip Code</label>
                <InputText @bind-Value="newItem.ZipCode" class="form-control" />
            </div>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
    </EditForm>
</ModalDialog>

@code {
    private List<Location> items = new(); private bool isLoading = true; private bool showModal; private Location newItem =
    new();
    protected override async Task OnInitializedAsync() => await LoadData();
    private async Task LoadData() { isLoading = true; items = await ClientService.GetLocationsAsync(); isLoading = false; }
    private async Task Save()
    {
        await ClientService.CreateLocationAsync(newItem); newItem = new(); showModal = false; await
    LoadData();
    }
    private async Task Delete(int id) { await ClientService.DeleteLocationAsync(id); await LoadData(); }
}
