@page "/timesheet/payroll/list/create"
@rendermode InteractiveServer
@using QMCH.Models

<PageTitle>@(isEdit ? "Edit" : "Create") Payroll Timesheet - Quality Homecare</PageTitle>

<div class="payroll-form-page">

    @if (hasError)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            <div>
                <strong>Error:</strong> @errorMessage
            </div>
            <button type="button"
                    class="btn-close"
                    @onclick="@(() => hasError = false)">
            </button>
        </div>
    }

    <div class="page-header">
        <div class="header-left">
            <h1>@(isEdit ? "Edit" : "Create") Timesheet</h1>
            <p>@(isEdit ? "Update" : "Create") payroll timesheet for Nurse and Pay Period</p>
        </div>

        <div class="header-right">
            <button class="btn btn-outline"
                    @onclick="BackToList">
                Back to List
            </button>
        </div>
    </div>

    <div class="content-container">
        <div class="form-card">
            <div class="card-header">
                <h3>Timesheet Details</h3>
            </div>

            <div class="card-body">

                @if (isLoading)
                {
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary"></div>
                    </div>
                }
                else
                {
                    <EditForm Model="model" OnValidSubmit="Save">
                        <DataAnnotationsValidator />
                        <ValidationSummary />

                        <!-- Employee Section -->
                        <div class="form-section">
                            <h4 class="section-title">Employee Information</h4>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Employee/Nurse *</label>
                                    <InputSelect @bind-Value="model.EmployeeId"
                                                 class="form-control"
                                                 disabled="@isEdit">
                                        <option value="0">-- Select Employee --</option>
                                        @foreach (var nurse in nurses)
                                        {
                                            <option value="@nurse.Id">
                                                @nurse.FirstName @nurse.LastName
                                            </option>
                                        }
                                    </InputSelect>
                                    <ValidationMessage For="@(() => model.EmployeeId)" />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Employee Name</label>
                                    <input class="form-control"
                                           value="@model.EmployeeName"
                                           disabled />
                                </div>
                            </div>
                        </div>

                        <!-- Pay Period -->
                        <div class="form-section">
                            <h4 class="section-title">Pay Period</h4>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">From Date *</label>
                                    <InputDate @bind-Value="model.PeriodStart"
                                               class="form-control" />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">To Date *</label>
                                    <InputDate @bind-Value="model.PeriodEnd"
                                               class="form-control" />
                                </div>
                            </div>
                        </div>

                        <!-- Hours & Rates -->
                        <div class="form-section">
                            <h4 class="section-title">Hours & Rates</h4>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Regular Hours</label>
                                    <InputNumber @bind-Value="model.RegularHours"
                                                 class="form-control" />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Overtime Hours</label>
                                    <InputNumber @bind-Value="model.OvertimeHours"
                                                 class="form-control" />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Regular Rate ($)</label>
                                    <InputNumber @bind-Value="model.PayRate"
                                                 class="form-control" />
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Overtime Rate ($)</label>
                                    <InputNumber @bind-Value="model.OvertimeRate"
                                                 class="form-control" />
                                </div>
                            </div>

                            <div class="summary-box">
                                <div class="summary-item">
                                    <span>Regular Pay:</span>
                                    <strong>$@(model.RegularHours* model.PayRate)</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Overtime Pay:</span>
                                    <strong>$@(model.OvertimeHours* model.OvertimeRate)</strong>
                                </div>
                                <div class="summary-item total">
                                    <span>Total Amount:</span>
                                    <strong>$@model.TotalAmount</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Additional -->
                        <div class="form-section">
                            <h4 class="section-title">Additional Information</h4>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <InputSelect @bind-Value="model.Category"
                                                 class="form-control">
                                        <option value="">-- Select --</option>
                                        <option value="Nurse">Nurse</option>
                                        <option value="Doctor">Doctor</option>
                                        <option value="Assistant">Assistant</option>
                                    </InputSelect>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <InputSelect @bind-Value="model.Status"
                                                 class="form-control">
                                        <option value="Pending">Pending</option>
                                        <option value="Approved">Approved</option>
                                        <option value="Rejected">Rejected</option>
                                        <option value="Paid">Paid</option>
                                    </InputSelect>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <InputTextArea @bind-Value="model.Notes"
                                               class="form-control"
                                               rows="3" />
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit"
                                    class="btn btn-primary">
                                @(isEdit ? "Update" : "Create") Timesheet
                            </button>

                            <button type="button"
                                    class="btn btn-outline"
                                    @onclick="BackToList">
                                Cancel
                            </button>
                        </div>
                    </EditForm>
                }

            </div>
        </div>
    </div>
</div>
