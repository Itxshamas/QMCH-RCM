@page "/caregiver/classifications/list"
@inject IEmployeeService EmployeeService
@rendermode InteractiveServer

<PageTitle>Classifications - QHMC</PageTitle>

<div class="page-header">
    <div class="page-header-left"><h1>Classifications</h1><p>Employee classification types</p></div>
    <div class="page-header-actions"><button class="btn btn-primary" @onclick="() => showModal = true"><i class="fa fa-plus"></i> Add Classification</button></div>
</div>

<DataGrid TItem="Classification" Items="items" Title="Classifications" IsLoading="isLoading">
    <HeaderTemplate><th>Code</th><th>Name</th><th>Description</th><th>Status</th><th style="width: 100px;">Actions</th></HeaderTemplate>
    <RowTemplate Context="item">
        <td><span class="badge badge-primary">@item.Code</span></td>
        <td><strong>@item.Name</strong></td>
        <td>@item.Description</td>
        <td><span class="badge @(item.IsActive ? "badge-success" : "badge-secondary")">@(item.IsActive ? "Active" : "Inactive")</span></td>
        <td><button class="btn btn-danger btn-sm" @onclick="() => Delete(item.Id)"><i class="fa fa-trash"></i></button></td>
    </RowTemplate>
</DataGrid>

<ModalDialog @bind-IsVisible="showModal" Title="Add Classification">
    <EditForm Model="newItem" OnValidSubmit="Save">
        <DataAnnotationsValidator />
        <div class="form-row">
            <div class="form-group"><label class="form-label">Name *</label><InputText @bind-Value="newItem.Name" class="form-control" /></div>
            <div class="form-group"><label class="form-label">Code</label><InputText @bind-Value="newItem.Code" class="form-control" /></div>
        </div>
        <div class="form-group"><label class="form-label">Description</label><InputTextArea @bind-Value="newItem.Description" class="form-control" /></div>
        <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
    </EditForm>
</ModalDialog>

@code {
    private List<Classification> items = new(); private bool isLoading = true; private bool showModal; private Classification newItem = new();
    protected override async Task OnInitializedAsync() => await LoadData();
    private async Task LoadData() { isLoading = true; items = await EmployeeService.GetClassificationsAsync(); isLoading = false; }
    private async Task Save() { await EmployeeService.CreateClassificationAsync(newItem); newItem = new(); showModal = false; await LoadData(); }
    private async Task Delete(int id) { await EmployeeService.DeleteClassificationAsync(id); await LoadData(); }
}
