@page "/hr/aquisition/requisition/list"
@inject IHRService HRService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Job Orders - QHMCPro</PageTitle>

<div class="page-header">
    <div class="page-header-left">
        <h1>Job Orders</h1>
        <p>Manage hiring requisitions</p>
    </div>
    <div class="page-header-actions"><button class="btn btn-primary"
            @onclick='() => Navigation.NavigateTo("/hr/aquisition/requisition/list/create")'><i class="fa fa-plus"></i>
            New Requisition</button></div>
</div>

<DataGrid TItem="JobOrder" Items="items" Title="Job Orders" IsLoading="isLoading" OnSearchChanged="HandleSearch">
    <HeaderTemplate>
        <th>Title</th>
        <th>Department</th>
        <th>Positions</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Posted</th>
        <th style="width: 120px;">Actions</th>
    </HeaderTemplate>
    <RowTemplate Context="item">
        <td><strong>@item.Title</strong></td>
        <td>@item.Department</td>
        <td>@item.NumberOfPositions</td>
        <td><span class="badge @GetPriorityBadge(item.Priority)">@item.Priority</span></td>
        <td><span class="badge @GetStatusBadge(item.Status)">@item.Status</span></td>
        <td>@item.PostedDate.ToString("MMM dd, yyyy")</td>
        <td>
            <div style="display: flex; gap: 6px;">
                <button class="btn btn-outline btn-sm"
                    @onclick='() => Navigation.NavigateTo($"/hr/aquisition/requisition/list/create?id={item.Id}")'><i
                        class="fa fa-edit"></i></button>
                <button class="btn btn-danger btn-sm" @onclick="() => Delete(item.Id)"><i
                        class="fa fa-trash"></i></button>
            </div>
        </td>
    </RowTemplate>
</DataGrid>

@code {
    private List<JobOrder> allItems = new(); private IEnumerable<JobOrder> items = Enumerable.Empty<JobOrder>(); private
    bool isLoading = true;
    protected override async Task OnInitializedAsync() => await LoadData();
    private async Task LoadData()
    {
        isLoading = true; allItems = await HRService.GetJobOrdersAsync(); items = allItems;
        isLoading = false;
    }
    private async Task Delete(int id) { await HRService.DeleteJobOrderAsync(id); await LoadData(); }
    private Task HandleSearch(string t)
    {
        items = string.IsNullOrWhiteSpace(t) ? allItems : allItems.Where(x =>
        x.Title.Contains(t, StringComparison.OrdinalIgnoreCase)); return Task.CompletedTask;
    }
    private string GetPriorityBadge(string p) => p switch
    {
        "High" => "badge-danger",
        "Medium" => "badge-warning",
        _ =>
        "badge-info"
    };
    private string GetStatusBadge(string s) => s switch
    {
        "Open" => "badge-success",
        "Filled" => "badge-primary",
        "Closed"
        => "badge-secondary",
        _ => "badge-info"
    };
}
