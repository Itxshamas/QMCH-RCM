@page "/client/clienttypes/list"

@rendermode InteractiveServer

@inject NavigationManager NavManager

<PageTitle>Client Types - QHMC</PageTitle>

<div class="top-buttons">
    <button class="btn-green" @onclick="ToggleQuickAdd">
        <i class="fa fa-plus"></i> Quick Add
    </button>
    <button class="btn-green" @onclick="GoToMassCreate">
        <i class="fa fa-edit"></i> Mass Create
    </button>
    <button class="btn-red" @onclick="DeleteSelected">
        <i class="fa fa-trash"></i> Delete
    </button>
</div>

@if (showQuickAdd)
{
    <div class="table-wrapper" style="margin-bottom:12px;">
        <div style="display:flex; gap:10px; align-items:end;">
            <div style="flex:1;">
                <label>Description</label>
                <input type="text" @bind="newItem.Description" maxlength="150" />
            </div>
            <div style="width:260px;">
                <label>Short Description</label>
                <input type="text" @bind="newItem.ShortDescription" maxlength="50" />
            </div>
            <div style="display:flex; gap:8px;">
                <button class="btn-green" @onclick="HandleSave">Save</button>
                <button class="btn-red" @onclick="CancelQuickAdd">Cancel</button>
            </div>
        </div>
    </div>
}

<div class="table-wrapper">
    <div class="table-controls">
        <div class="table-controls-left">
            Show
            <select @onchange="ChangePageSize" value="@pageSize">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
            </select>
            entries
        </div>
        <div class="table-controls-right">
            Search:
            <input type="text" @bind="searchText" @bind:event="oninput" placeholder="Search..." />
        </div>
    </div>

    <table class="custom-table">
        <thead>
            <tr>
                <th style="width:40px;">
                    <input type="checkbox" @onclick="ToggleSelectAll" checked="@IsAllSelected" />
                </th>
                <th style="width:40px;">&nbsp;</th>
                <th>
                    Description
                    <i class="fa fa-sort" style="font-size:11px; margin-left:4px;"></i>
                </th>
                <th>Short Description</th>
                <th style="width:140px;"></th>
            </tr>
        </thead>
        <tbody>
            @if (pagedItems != null)
            {
                @foreach (var item in pagedItems)
                {
                    <tr class="data-row">
                        <td>
                            <input type="checkbox" @onchange="() => ToggleSelectItem(item.Id)" checked="@selectedIds.Contains(item.Id)" />
                        </td>
                        <td style="text-align:center; color:#999;">
                            <i class="fa fa-bars" title="Drag"></i>
                        </td>
                        <td>@item.Description</td>
                        <td>@item.ShortDescription</td>
                        <td class="action-cell">
                            <button class="icon-btn" title="View" @onclick="() => ShowView(item)">
                                <i class="fa fa-search"></i>
                            </button>
                            <button class="icon-btn" title="Edit" @onclick="() => ShowEdit(item)">
                                <i class="fa fa-pen"></i>
                            </button>
                            <button class="icon-btn" title="Delete" @onclick="() => DeleteSingle(item.Id)">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <div class="table-footer">
        <div>
            Showing @((items.Count == 0) ? 0 : ((currentPage - 1) * pageSize + 1)) to @(((currentPage - 1) * pageSize) + pagedItems.Count) of @filteredItems.Count entries
        </div>
        <div class="pagination">
            <button @onclick="PrevPage">Previous</button>
            <button class="active">@currentPage</button>
            <button @onclick="NextPage">Next</button>
        </div>
    </div>
</div>

@if (viewItem != null)
{
    <div class="modal-backdrop">
        <div class="modal-box modal-green">
            <h4>View Client Type</h4>
            <div class="modal-field">
                <label>Description</label>
                <div>@viewItem.Description</div>
            </div>
            <div class="modal-field">
                <label>Short Description</label>
                <div>@viewItem.ShortDescription</div>
            </div>
            <div class="modal-field">
                <label>Audit</label>
                <div>N/A</div>
            </div>
            <div class="modal-actions">
                <button class="btn-green" @onclick="() => viewItem = null">Close</button>
            </div>
        </div>
    </div>
}

@if (editItem != null)
{
    <div class="modal-backdrop">
        <div class="modal-box modal-green">
            <h4>Update Client Type</h4>
            <div class="modal-field">
                <label>Description</label>
                <input type="text" @bind="editItem.Description" />
            </div>
            <div class="modal-field">
                <label>Short Description</label>
                <input type="text" @bind="editItem.ShortDescription" />
            </div>
            <div class="modal-actions">
                <button class="btn-green" @onclick="HandleUpdate">Update</button>
                <button class="btn-red" @onclick="() => editItem = null">Cancel</button>
            </div>
        </div>
    </div>
}